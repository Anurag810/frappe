{% extends "templates/web.html" %}

{% block title %} Unsubscribe from Newsletter {% endblock %}

{% block page_content %}

	<script>

		frappe.ready(function(){
			$("#select").click(function(){
				if($("#select").prop("checked") == true){
					$(".group").prop('checked', true);
				}
				else{
					$(".group").prop('checked', false);
				}
			});
		});
	</script>

	{% if status == "confirmation page" %}
	<!-- confirmation page to select the group for unsubscription -->
		<div class="page-card">
			<div class='page-card-head'>
				<span class='indicator blue'>Unsubscribe</span>
			</div>
			{% if email_groups != "none" %}
				<div>
					Select groups you wish to unsubscribe from.
					<span class="text-muted">mishranaman123@gmail.com</span>
				</div>
				<form method="post">
						<input type="hidden" name="user_email" value="{{email}}">
						<input type="hidden" name="csrf_token" value="{{ frappe.session.csrf_token }}">
						<div class="checkbox">
					<div class="checkbox" style="margin-top: 10px; border-bottom:2px solid #D3D3D3; border-width: 1px">
						<label><input type="checkbox" id="select"><span style="padding-left: 20px">Select all</span></label>
					</div>
					{% for group in email_groups %}
					{% if current_group[0].email_group == group.email_group %}
						<div class="checkbox">
							<label><input type="checkbox" checked class="group" name='{{group.email_group}}'><span style="padding-left: 20px">{{group.email_group}}</span></label>
						</div>
					{% else %}
						<div class="checkbox">
								<label><input type="checkbox" class="group" name='{{group.email_group}}'><span style="padding-left: 20px">{{group.email_group}}</span></label>
						</div>
					{% endif %}
					{% endfor %}
					<p class='password-strength-message text-muted small hidden'></p>
					<button type="submit" id="unsubscribe"
						class="btn btn-primary">Unsubscribe</button>
				</form>
			{% else %}
				<div>
					You are not registered to any mailing list.
				<span class="text-muted">mishranaman123@gmail.com</span>
			</div>
			{% endif %}
		</div>

	{% elif status == "Unsubscribed page" %}
	<!-- Unsubscribed page comes after submission -->
		<div class="page-card">
			<div class='page-card-head'>
				<span class='indicator green'>Unsubscribed</span>
			</div>
			You have been unsubscribed from selected mailing list.
		</div>

	{% else %}
	<!-- For invalid and unsigned request -->
		<div class="page-card">
			<div class='page-card-head'>
				<span class='indicator red'>Unsubscribe</span>
			</div>
			<b>Invalid Request.</b>
		</div>
	{% endif %}

	<style>
	.hero-and-content {
		background-color: #f5f7fa;
	}
	</style>
{% endblock %}

{% block style %}
	<style>
		{% include "templates/styles/card_style.css" %}
	</style>
{% endblock %}

